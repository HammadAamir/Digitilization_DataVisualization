<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digitization Data Visualization</title>
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- D3.js CDN -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Three.js CDN for 3D globe -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scroll issues during transitions */
            perspective: 1000px; /* For 3D transformations */
        }

        /* Base styles for the Mac container */
        .mac-container {
            position: relative;
            width: 90vw; /* Initial large size */
            max-width: 1200px; /* Max width for desktop */
            height: calc(0.5625 * 90vw); /* 16:9 aspect ratio */
            max-height: 675px; /* Max height for desktop (1200 * 9 / 16) */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #1f2937; /* Dark gray for Mac body */
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            transition: all 1s ease-in-out; /* Smooth transition */
            transform-origin: center center;
            will-change: width, height, transform, left; /* Optimize for animation */
        }

        /* Mac screen styles */
        .mac-screen {
            background-color: #000;
            width: calc(100% - 20px); /* Inner screen with a small bezel */
            height: calc(100% - 60px); /* Adjust height for bezel and bottom bar */
            border-radius: 10px;
            overflow: hidden; /* Hide overflowing content */
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Mac bottom bezel/stand area */
        .mac-bottom-bar {
            width: 100%;
            height: 40px; /* Bezel height */
            background-color: #1f2937;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            color: #ccc;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Mac stand */
        .mac-stand {
            position: absolute;
            bottom: -50px; /* Position below the main body */
            width: 120px;
            height: 50px;
            background-color: #1f2937;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5);
            z-index: -1; /* Behind the Mac body */
        }
        .mac-stand::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 30px;
            background-color: #2f3e4f;
            border-radius: 0 0 5px 5px;
        }


        /* iPhone container styles (initial state) */
        .iphone-container {
            position: absolute;
            left: -50vw; /* Off-screen initially by a large margin */
            top: 50%;
            transform: translateY(-50%) scale(0.8); /* Smaller when off-screen */
            width: 380px; /* Base size, will be overridden by vw in chart-view */
            height: 760px; /* Base size, will be overridden by vw in chart-view */
            background-color: #1f2937; /* iPhone body color */
            border-radius: 50px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            opacity: 0; /* Hidden initially */
            transition: all 1s ease-in-out;
            pointer-events: none; /* Disable interaction when hidden */
            z-index: 10;
        }

        /* iPhone screen styles (initial state) */
        .iphone-screen {
            background-color: #000;
            width: calc(100% - 10px); /* Inner screen with small bezel */
            height: calc(100% - 10px);
            border-radius: 45px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }

        /* iPhone notch (initial state) */
        .iphone-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 30px;
            background-color: #000;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            z-index: 2;
        }


        /* State after button click (Chart View) */
        body.chart-view .mac-container {
            width: 77.5vw; /* Mac width remains the same */
            max-width: 900px;
            height: calc(0.5625 * 77.5vw); /* Maintain aspect ratio */
            max-height: 506px;
            transform: translateX(22.5vw); /* Moves to the right, adjacent to iPhone */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5); /* Less intense shadow */
        }

        body.chart-view .iphone-container {
            left: 0; /* iPhone starts from the very left edge */
            width: 22.5vw; /* iPhone takes 15vw * 1.5 = 22.5vw of viewport width */
            height: calc(2 * 22.5vw); /* Maintain 1:2 aspect ratio for iPhone */
            opacity: 1; /* Make visible */
            pointer-events: auto; /* Enable interaction */
            transform: translateY(-50%); /* No additional scale, it's at its target responsive size */
            border-radius: 3vw; /* Proportional border-radius for 1.5x size */
            max-width: none;
            max-height: none;
        }

        body.chart-view .iphone-screen {
            border-radius: calc(3vw - 5px); /* Slightly smaller than container border for bezel effect */
            padding: 1.5vw; /* Responsive padding for 1.5x size */
        }

        body.chart-view .iphone-screen::before {
            width: 7.5vw; /* Responsive notch width for 1.5x size */
            height: 2.25vw; /* Responsive notch height for 1.5x size */
            border-bottom-left-radius: 1.5vw;
            border-bottom-right-radius: 1.5vw;
        }


        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .mac-container {
                width: 95vw;
                height: calc(0.5625 * 95vw);
                border-radius: 10px;
            }
            .mac-screen {
                border-radius: 5px;
            }
            .mac-bottom-bar {
                height: 25px;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
            }
            .mac-stand {
                bottom: -30px;
                width: 80px;
                height: 30px;
            }

            /* Adjusted iPhone for mobile in chart view */
            body.chart-view .iphone-container {
                width: 37.5vw; /* iPhone takes 25vw * 1.5 = 37.5vw on mobile */
                height: calc(2 * 37.5vw);
                left: 0;
                border-radius: 4vw; /* Adjusted for mobile scale */
            }
            body.chart-view .iphone-screen {
                border-radius: calc(4vw - 5px);
                padding: 1.5vw;
            }
            body.chart-view .iphone-screen::before {
                width: 12vw; /* Adjusted for mobile scale */
                height: 3.75vw; /* Adjusted for mobile scale */
                border-bottom-left-radius: 2vw;
                border-bottom-right-radius: 2vw;
            }

            body.chart-view .mac-container {
                width: 62.5vw; /* Mac takes 100% - 37.5% (iPhone width) on mobile */
                height: calc(0.5625 * 62.5vw);
                transform: translateX(37.5vw); /* Pushed to the right by iPhone's width on mobile */
            }

            .mac-screen p {
                font-size: 0.9rem;
            }
            .iphone-screen p {
                font-size: 0.8rem;
            }
            .action-button {
                padding: 8px 16px;
                font-size: 0.9rem;
            }

            /* 3D globe canvas size for mobile */
            #globe-canvas {
                width: 150px;
                height: 150px;
            }
        }

        /* General text styles */
        .project-text, .chart-text {
            text-align: center;
            max-width: 80%;
            margin: 0 auto;
            line-height: 1.6;
            color: #e2e8f0;
            opacity: 1; /* Ensure text is visible after transition */
            transition: opacity 0.5s ease-in-out;
            font-size: 1rem;
        }

        /* Hide initial content when chart view is active */
        body.chart-view .initial-content {
            opacity: 0;
            pointer-events: none;
            position: absolute;
        }

        /* Show chart content when chart view is active */
        body.chart-view .chart-content {
            opacity: 1;
            pointer-events: auto;
            position: relative;
        }

        .chart-content {
            opacity: 0;
            pointer-events: none;
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .action-button {
            background-color: #3b82f6; /* Blue */
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            margin-top: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .action-button:hover {
            background-color: #2563eb;
            transform: translateY(-2px);
        }
        .action-button:active {
            transform: translateY(0);
        }

        /* Back button specific styles */
        .back-button {
            background-color: #f63b3b; /* Red */
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            margin-top: 20px; /* Space from text */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .back-button:hover {
            background-color: #eb2525;
            transform: translateY(-2px);
        }
        .back-button:active {
            transform: translateY(0);
        }

        /* 3D Globe Canvas styles */
        #globe-canvas {
            width: 200px; /* Set a fixed size for the globe canvas */
            height: 200px;
            display: block; /* Important for canvas */
            margin-bottom: 20px; /* Added margin similar to previous globe */
        }


        /* D3 chart specific styles */
        .d3-chart-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .bar {
            fill: #4CAF50; /* Green bars */
            transition: fill 0.3s ease;
        }
        .bar:hover {
            fill: #81C784; /* Lighter green on hover */
        }
        .axis path,
        .axis line {
            stroke: #e2e8f0; /* White for axes */
            stroke-width: 1;
        }
        .axis text {
            fill: #e2e8f0; /* White for axis labels */
            font-size: 0.75rem;
        }
        .d3-tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 0px;
            border-radius: 5px;
            pointer-events: none;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            z-index: 100;
        }

    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">

    <!-- iPhone Container (initially hidden) -->
    <div id="iphone-container" class="iphone-container">
        <div class="iphone-screen">
            <p class="chart-text">
                This chart illustrates the exponential growth in global digital data. Each bar represents a year, showing the rapid increase in zettabytes generated worldwide. This trend highlights the critical need for efficient data visualization techniques to make sense of this immense volume.
            </p>
            <button id="back-button" class="back-button">Back</button>
        </div>
    </div>

    <!-- Mac Container -->
    <div id="mac-container" class="mac-container">
        <div class="mac-screen">
            <!-- Initial content inside Mac screen -->
            <div id="initial-mac-content" class="initial-content flex flex-col items-center justify-content-center w-full h-full">
                <canvas id="globe-canvas" class="mb-8"></canvas>
                <p class="project-text mb-8">
                    Welcome to my project on digitization and its impact! This visualization journey explores how data is transforming our world, from complex datasets to intuitive insights. Click the button below to delve deeper into the numbers.
                </p>
                <button id="show-chart-button" class="action-button">Explore Data</button>
            </div>

            <!-- Chart content inside Mac screen (initially hidden) -->
            <div id="chart-mac-content" class="chart-content flex flex-col items-center justify-content-center w-full h-full">
                <div class="d3-chart-container w-full h-full">
                    <!-- D3.js chart will be rendered here -->
                </div>
            </div>
        </div>
        <div class="mac-bottom-bar">
            <span>macOS Monterey</span>
        </div>
        <div class="mac-stand"></div>
    </div>

    <div id="tooltip" class="d3-tooltip"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const showChartButton = document.getElementById('show-chart-button');
            const backButton = document.getElementById('back-button');
            const macContainer = document.getElementById('mac-container');
            const iphoneContainer = document.getElementById('iphone-container');
            const initialMacContent = document.getElementById('initial-mac-content');
            const chartMacContent = document.getElementById('chart-mac-content');
            const d3ChartContainer = document.querySelector('.d3-chart-container');
            const body = document.body;

            // Sample data for the D3 chart (Zettabytes of data generated per year)
            const data = [
                { year: 2018, zettabytes: 33 },
                { year: 2019, zettabytes: 41 },
                { year: 2020, zettabytes: 59 },
                { year: 2021, zettabytes: 79 },
                { year: 2022, zettabytes: 97 },
                { year: 2023, zettabytes: 120 },
                { year: 2024, zettabytes: 145 },
                { year: 2025, zettabytes: 175 }
            ];

            // THREE.js Global variables for the 3D globe
            let scene, camera, renderer, globe, lines;
            let animationFrameId; // To store the requestAnimationFrame ID
            let isGlobeInitialized = false; // Flag to track if globe is initialized

            /**
             * Initializes the 3D globe using Three.js.
             * Sets up the scene, camera, renderer, globe sphere, and grid lines.
             */
            function initGlobe() {
                if (isGlobeInitialized) return; // Prevent re-initialization
                const canvas = document.getElementById('globe-canvas');
                if (!canvas) return; // Ensure canvas exists

                const width = canvas.offsetWidth;
                const height = canvas.offsetHeight;

                // Scene setup
                scene = new THREE.Scene();

                // Camera setup
                camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                camera.position.z = 2; // Position camera away from the globe for a clear view

                // Renderer setup with transparency
                renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
                renderer.setSize(width, height);
                renderer.setClearColor(0x000000, 0); // Transparent background

                // Globe Sphere creation
                const geometry = new THREE.SphereGeometry(1, 32, 32); // Radius, widthSegments, heightSegments
                const material = new THREE.MeshPhongMaterial({
                    color: 0x3498db, // A shade of blue for the globe
                    specular: 0x555555,
                    shininess: 30,
                    transparent: true,
                    opacity: 0.9 // Slightly transparent
                });
                globe = new THREE.Mesh(geometry, material);
                scene.add(globe);

                // Add digital-looking grid lines to the globe
                const wireframe = new THREE.WireframeGeometry(geometry);
                const lineMaterial = new THREE.LineBasicMaterial({
                    color: 0xffffff, // White lines
                    linewidth: 1, // Note: linewidth property might not be fully supported across all platforms
                    transparent: true,
                    opacity: 0.3 // Semi-transparent lines
                });
                lines = new THREE.LineSegments(wireframe, lineMaterial);
                scene.add(lines);

                // Lighting for the scene
                const ambientLight = new THREE.AmbientLight(0x404040); // Soft ambient light
                scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8); // Directional light for shadows/highlights
                directionalLight.position.set(0, 1, 1).normalize(); // Position the light
                scene.add(directionalLight);

                isGlobeInitialized = true;
                animateGlobe(); // Start the animation loop for the globe
            }

            /**
             * Animation loop for the 3D globe.
             * Rotates the globe and renders the scene.
             */
            function animateGlobe() {
                if (!isGlobeInitialized) return; // Only animate if initialized
                animationFrameId = requestAnimationFrame(animateGlobe);

                // Rotate the globe and its lines
                globe.rotation.y += 0.005;
                lines.rotation.y += 0.005;

                renderer.render(scene, camera);
            }

            /**
             * Resizes the Three.js canvas and updates the camera aspect ratio on window resize.
             */
            function resizeGlobeCanvas() {
                if (!isGlobeInitialized || !renderer) return;
                const canvas = document.getElementById('globe-canvas');
                if (!canvas) return;
                const width = canvas.offsetWidth;
                const height = canvas.offsetHeight;
                renderer.setSize(width, height);
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.render(scene, camera); // Re-render after resize
            }

            /**
             * Disposes of Three.js resources to free up memory.
             */
            function disposeGlobe() {
                if (!isGlobeInitialized) return; // Only dispose if initialized

                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                if (renderer) {
                    renderer.dispose();
                    renderer = null;
                }
                // Dispose of scene objects' geometries and materials
                if (scene) {
                    scene.traverse(function(object) {
                        if (object.geometry) object.geometry.dispose();
                        if (object.material) {
                            if (object.material.length) {
                                for (let i = 0; i < object.material.length; i++) {
                                    object.material[i].dispose();
                                }
                            } else {
                                object.material.dispose();
                            }
                        }
                        if (object.texture) object.texture.dispose();
                    });
                    scene = null;
                }
                globe = null;
                lines = null;
                camera = null;

                // Clear the canvas element to remove old rendering context
                const canvas = document.getElementById('globe-canvas');
                if (canvas) {
                    const gl = canvas.getContext('webgl');
                    if (gl) {
                        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                    }
                }
                isGlobeInitialized = false; // Reset initialization flag
            }

            // Function to handle showing the chart view
            showChartButton.addEventListener('click', () => {
                disposeGlobe(); // Stop and dispose globe when switching to chart view
                body.classList.add('chart-view');

                // Hide initial content after a short delay to allow Mac transition to start
                setTimeout(() => {
                    initialMacContent.style.opacity = '0';
                    initialMacContent.style.pointerEvents = 'none'; // Disable interaction
                }, 500);

                // After the Mac transition, show chart content and draw chart
                macContainer.addEventListener('transitionend', function handler() {
                    if (body.classList.contains('chart-view')) {
                        initialMacContent.style.display = 'none'; // Fully hide
                        chartMacContent.style.opacity = '1';
                        chartMacContent.style.pointerEvents = 'auto'; // Enable interaction
                        drawChart(); // Draw D3 chart once animation is mostly complete
                    }
                    macContainer.removeEventListener('transitionend', handler);
                });
            });

            // Function to handle going back to the initial view
            backButton.addEventListener('click', () => {
                body.classList.remove('chart-view');

                // Hide chart content immediately as Mac transitions back
                chartMacContent.style.opacity = '0';
                chartMacContent.style.pointerEvents = 'none'; // Disable interaction

                // After the Mac transition back, show initial content and re-initialize globe
                macContainer.addEventListener('transitionend', function handler() {
                    if (!body.classList.contains('chart-view')) {
                        // Ensure it's the correct transition back
                        initialMacContent.style.display = 'flex'; // Show again
                        initialMacContent.style.opacity = '1';
                        initialMacContent.style.pointerEvents = 'auto'; // Enable interaction
                        setTimeout(initGlobe, 100); // Re-initialize globe after a slight delay
                    }
                    macContainer.removeEventListener('transitionend', handler);
                });
            });


            /**
             * Draws the D3.js bar chart.
             * This function is called when the chart view is activated.
             */
            function drawChart() {
                // Clear any existing SVG to prevent duplicates on redraws
                d3ChartContainer.innerHTML = '';

                // Set the dimensions of the chart container dynamically
                const containerWidth = d3ChartContainer.offsetWidth;
                const containerHeight = d3ChartContainer.offsetHeight;

                const margin = { top: 20, right: 30, bottom: 40, left: 50 };
                const width = containerWidth - margin.left - margin.right;
                const height = containerHeight - margin.top - margin.bottom;

                // Append the SVG object to the d3ChartContainer
                const svg = d3.select(d3ChartContainer)
                    .append("svg")
                    .attr("width", containerWidth)
                    .attr("height", containerHeight)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // X axis
                const x = d3.scaleBand()
                    .range([0, width])
                    .domain(data.map(d => d.year))
                    .padding(0.2);

                svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                    .attr("class", "axis");

                // Y axis
                const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.zettabytes) + 20]) // Add some padding to the max
                    .range([height, 0]);

                svg.append("g")
                    .call(d3.axisLeft(y))
                    .attr("class", "axis");

                // Tooltip
                const tooltip = d3.select("#tooltip");

                // Bars
                svg.selectAll(".bar")
                    .data(data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.year))
                    .attr("y", d => y(d.zettabytes))
                    .attr("width", x.bandwidth())
                    .attr("height", d => height - y(d.zettabytes))
                    .on("mouseover", function(event, d) {
                        tooltip.style("opacity", 1)
                               .html(`Year: ${d.year}<br>Data: ${d.zettabytes} ZB`)
                               .style("left", (event.pageX + 10) + "px")
                               .style("top", (event.pageY - 28) + "px");
                        d3.select(this).style("fill", "#81C784"); // Lighter green on hover
                    })
                    .on("mouseout", function(event, d) {
                        tooltip.style("opacity", 0);
                        d3.select(this).style("fill", "#4CAF50"); // Original green
                    });

                // Add X axis label
                svg.append("text")
                    .attr("class", "axis-label")
                    .attr("text-anchor", "middle")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom - 5)
                    .attr("fill", "#e2e8f0")
                    .text("Year");

                // Add Y axis label
                svg.append("text")
                    .attr("class", "axis-label")
                    .attr("text-anchor", "middle")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -margin.left + 15)
                    .attr("x", -height / 2)
                    .attr("fill", "#e2e8f0")
                    .text("Zettabytes (ZB)");

                // Handle window resize for responsiveness
                window.addEventListener('resize', () => {
                    // Only redraw chart if it's currently visible
                    if (body.classList.contains('chart-view')) {
                        drawChart();
                    }
                });
            }

            // Initial call to setup globe when DOM is ready
            // A slight delay ensures canvas dimensions are stable after CSS loads
            window.onload = function() {
                setTimeout(initGlobe, 100);
            };

            // Add resize listener for the globe canvas
            window.addEventListener('resize', () => {
                // Ensure the globe canvas is present before attempting to resize
                const globeCanvas = document.getElementById('globe-canvas');
                if (globeCanvas && !body.classList.contains('chart-view')) {
                    resizeGlobeCanvas();
                }
            });
        });
    </script>
</body>
</html>
